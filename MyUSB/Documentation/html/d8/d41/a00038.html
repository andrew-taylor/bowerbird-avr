<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>MyUSB Library: DynAlloc.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='../../open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='../../closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='../../closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="../../classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../dir_2e1fbef791c6441b28631243cfb4eaa5.html">MyUSB</a>&nbsp;&raquo&nbsp;<a class="el" href="../../dir_50e52ad6725699dcfe5193cbabf0ca63.html">MemoryAllocator</a>
  </div>
</div>
<div class="contents">
<h1>DynAlloc.h File Reference</h1><code>#include &lt;avr/io.h&gt;</code><br>
<code>#include &lt;stdbool.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d41/a00038.html#7667b374d6cbdd8153cf7f2de34ef004">DEREF</a>(handle, type)&nbsp;&nbsp;&nbsp;(*(type*)handle)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d41/a00038.html#5e944fcf1de25a76d65629b2b853e9de">ALLOCABLE_BYTES</a>&nbsp;&nbsp;&nbsp;(1UL * NUM_BLOCKS * BLOCK_SIZE)</td></tr>

<tr><td colspan="2"><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef const void **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d41/a00038.html#4c6a342685ef8cadab29bc3a650dd10a">Mem_Handle_t</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d41/a00038.html#6216f85fc2d8819a87c5ba6f1c41c38d">Alloc_Size_t</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d41/a00038.html#624cbb6eb017c90624899fce4994f8a0">Block_Number_t</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d41/a00038.html#7fbda3b3fd15b09edb224cd5dac547a3">Handle_Number_t</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d8/d41/a00038.html#4c6a342685ef8cadab29bc3a650dd10a">Mem_Handle_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d41/a00038.html#3c1c0eead8c87f340701c7bf3601d66e">Mem_Alloc</a> (const <a class="el" href="../../d8/d41/a00038.html#6216f85fc2d8819a87c5ba6f1c41c38d">Alloc_Size_t</a> Bytes)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d8/d41/a00038.html#4c6a342685ef8cadab29bc3a650dd10a">Mem_Handle_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d41/a00038.html#87c060debbf6b2a12b09306da25c3147">Mem_Calloc</a> (const <a class="el" href="../../d8/d41/a00038.html#6216f85fc2d8819a87c5ba6f1c41c38d">Alloc_Size_t</a> Bytes)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d8/d41/a00038.html#4c6a342685ef8cadab29bc3a650dd10a">Mem_Handle_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d41/a00038.html#2558f282a791319133c91469d18655a2">Mem_Realloc</a> (<a class="el" href="../../d8/d41/a00038.html#4c6a342685ef8cadab29bc3a650dd10a">Mem_Handle_t</a> CurrAllocHdl, const <a class="el" href="../../d8/d41/a00038.html#6216f85fc2d8819a87c5ba6f1c41c38d">Alloc_Size_t</a> Bytes)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d41/a00038.html#edb2903683a669363c8362e8915b68f8">Mem_Free</a> (<a class="el" href="../../d8/d41/a00038.html#4c6a342685ef8cadab29bc3a650dd10a">Mem_Handle_t</a> CurrAllocHdl)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d8/d41/a00038.html#624cbb6eb017c90624899fce4994f8a0">Block_Number_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d41/a00038.html#0044a66c59b5b0274eb4d35f17398472">Mem_TotalFreeBlocks</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d8/d41/a00038.html#7fbda3b3fd15b09edb224cd5dac547a3">Handle_Number_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d41/a00038.html#eef5726b049ea781dac527c085dac1e1">Mem_TotalFreeHandles</a> (void)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Dynamic, auto-defragmenting block memory allocator library. This library provides a convenient replacement for the standard avr-libc dynamic memory allocation routines. Memory is handed out in block chunks, to reduce the management memory overhead.<p>
Unlike the normal memory allocation routines, this library gives out handles to memory which must be dereferenced at the exact time of use, rather than handing back direct memory pointers. By using library managed handles instead of pointers, allocated memory blocks can be shifted around as needed transparently to defragment the memory as more blocks are requested.<p>
The memory heap is static, thus the total memory usage of the compiled application (as reported by the avr-size tool of the AVR-GCC toolchain) includes the dynamic memory heap.<p>
The constants NUM_BLOCKS, BLOCK_SIZE and NUM_HANDLES must be defined in the project makefile (and passed to the preprocessor via the -D GCC switch) for this library to compile. <hr><h2>Define Documentation</h2>
<a class="anchor" name="5e944fcf1de25a76d65629b2b853e9de"></a><!-- doxytag: member="DynAlloc.h::ALLOCABLE_BYTES" ref="5e944fcf1de25a76d65629b2b853e9de" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ALLOCABLE_BYTES&nbsp;&nbsp;&nbsp;(1UL * NUM_BLOCKS * BLOCK_SIZE)          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Constant, giving the total heap size in bytes. 
</div>
</div><p>
<a class="anchor" name="7667b374d6cbdd8153cf7f2de34ef004"></a><!-- doxytag: member="DynAlloc.h::DEREF" ref="7667b374d6cbdd8153cf7f2de34ef004" args="(handle, type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEREF          </td>
          <td>(</td>
          <td class="paramtype">handle,         <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%">&nbsp;&nbsp;&nbsp;(*(type*)handle)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Macro to dereference a given memory handle into the given type. The given type should be a pointer if the memory is to contain an array of items, or should be a standard type (such as a primative or structure) if the memory is to hold a single item of a single type. 
</div>
</div><p>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="6216f85fc2d8819a87c5ba6f1c41c38d"></a><!-- doxytag: member="DynAlloc.h::Alloc_Size_t" ref="6216f85fc2d8819a87c5ba6f1c41c38d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef uint32_t <a class="el" href="../../d8/d41/a00038.html#6216f85fc2d8819a87c5ba6f1c41c38d">Alloc_Size_t</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Type define for the size (in bytes) for an allocation for passing to the library functions. The exact type width varies depending on the value of ALLOCABLE_BYTES to ensure that a single allocation can request the entire heap if needed. 
</div>
</div><p>
<a class="anchor" name="624cbb6eb017c90624899fce4994f8a0"></a><!-- doxytag: member="DynAlloc.h::Block_Number_t" ref="624cbb6eb017c90624899fce4994f8a0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef uint32_t <a class="el" href="../../d8/d41/a00038.html#624cbb6eb017c90624899fce4994f8a0">Block_Number_t</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Type define for a block number in the heap. The exact type width varies depending on the value of NUM_BLOCKS to ensure that the type can store an index to any block in the block pool. 
</div>
</div><p>
<a class="anchor" name="7fbda3b3fd15b09edb224cd5dac547a3"></a><!-- doxytag: member="DynAlloc.h::Handle_Number_t" ref="7fbda3b3fd15b09edb224cd5dac547a3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef uint32_t <a class="el" href="../../d8/d41/a00038.html#7fbda3b3fd15b09edb224cd5dac547a3">Handle_Number_t</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Type define for a handle number. The exact type width varies depending on the value of NUM_HANDLES to ensure that the type can store the index of any handle in the handle pool. 
</div>
</div><p>
<a class="anchor" name="4c6a342685ef8cadab29bc3a650dd10a"></a><!-- doxytag: member="DynAlloc.h::Mem_Handle_t" ref="4c6a342685ef8cadab29bc3a650dd10a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef const void** <a class="el" href="../../d8/d41/a00038.html#4c6a342685ef8cadab29bc3a650dd10a">Mem_Handle_t</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Memory handle type, used to store handles given by the library functions. 
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="3c1c0eead8c87f340701c7bf3601d66e"></a><!-- doxytag: member="DynAlloc.h::Mem_Alloc" ref="3c1c0eead8c87f340701c7bf3601d66e" args="(const Alloc_Size_t Bytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d8/d41/a00038.html#4c6a342685ef8cadab29bc3a650dd10a">Mem_Handle_t</a> Mem_Alloc           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d8/d41/a00038.html#6216f85fc2d8819a87c5ba6f1c41c38d">Alloc_Size_t</a>&nbsp;</td>
          <td class="paramname"> <em>Bytes</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Allocates a given number of blocks from the heap (calculated from the requested number of bytes) and returns a handle to the newly allocated memory.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>Bytes</em>&nbsp;</td><td>The number of bytes requested to be allocated from the heap</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL handle if the allocation fails, or handle to the allocated memory if the allocation succeeds </dd></dl>

</div>
</div><p>
<a class="anchor" name="87c060debbf6b2a12b09306da25c3147"></a><!-- doxytag: member="DynAlloc.h::Mem_Calloc" ref="87c060debbf6b2a12b09306da25c3147" args="(const Alloc_Size_t Bytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d8/d41/a00038.html#4c6a342685ef8cadab29bc3a650dd10a">Mem_Handle_t</a> Mem_Calloc           </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d8/d41/a00038.html#6216f85fc2d8819a87c5ba6f1c41c38d">Alloc_Size_t</a>&nbsp;</td>
          <td class="paramname"> <em>Bytes</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Allocates a given number of blocks from the heap (calculated from the requested number of bytes) and returns a handle to the newly allocated memory. Calloced memory is automatically cleared to all 0x00 values at the time of allocation.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>Bytes</em>&nbsp;</td><td>The number of pre-cleared bytes requested to be allocated from the heap</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL handle if the allocation fails, or handle to the allocated memory if the allocation succeeds </dd></dl>

</div>
</div><p>
<a class="anchor" name="edb2903683a669363c8362e8915b68f8"></a><!-- doxytag: member="DynAlloc.h::Mem_Free" ref="edb2903683a669363c8362e8915b68f8" args="(Mem_Handle_t CurrAllocHdl)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mem_Free           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d8/d41/a00038.html#4c6a342685ef8cadab29bc3a650dd10a">Mem_Handle_t</a>&nbsp;</td>
          <td class="paramname"> <em>CurrAllocHdl</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Deallocates a given previously allocated section of memory from the heap.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>CurrAllocHdl</em>&nbsp;</td><td>Handle to a previously allocated section of memory in the heap </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="2558f282a791319133c91469d18655a2"></a><!-- doxytag: member="DynAlloc.h::Mem_Realloc" ref="2558f282a791319133c91469d18655a2" args="(Mem_Handle_t CurrAllocHdl, const Alloc_Size_t Bytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d8/d41/a00038.html#4c6a342685ef8cadab29bc3a650dd10a">Mem_Handle_t</a> Mem_Realloc           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d8/d41/a00038.html#4c6a342685ef8cadab29bc3a650dd10a">Mem_Handle_t</a>&nbsp;</td>
          <td class="paramname"> <em>CurrAllocHdl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d8/d41/a00038.html#6216f85fc2d8819a87c5ba6f1c41c38d">Alloc_Size_t</a>&nbsp;</td>
          <td class="paramname"> <em>Bytes</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Deallocates a given memory handle, and attempts to allocates the given number of blocks from the heap (calculated from the requested number of bytes) immediately following the deallocation. The new memory may be located in the same area as the previous memory, but this is not guaranteed.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>CurrAllocHdl</em>&nbsp;</td><td>Handle to an already allocated section of memory in the heap to deallocate </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>Bytes</em>&nbsp;</td><td>The number of bytes requested to be allocated from the heap following the deallocation</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL handle if the allocation fails, or handle to the allocated memory if the allocation succeeds</dd></dl>
<dl class="warning" compact><dt><b>Warning:</b></dt><dd>Even if the allocation fails, the deallocation will still occur. Care should be taken to ensure that the previously allocated memory is not used following an unsucessful realloc(). </dd></dl>

</div>
</div><p>
<a class="anchor" name="0044a66c59b5b0274eb4d35f17398472"></a><!-- doxytag: member="DynAlloc.h::Mem_TotalFreeBlocks" ref="0044a66c59b5b0274eb4d35f17398472" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d8/d41/a00038.html#624cbb6eb017c90624899fce4994f8a0">Block_Number_t</a> Mem_TotalFreeBlocks           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the total number of unallocated blocks in the heap.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Number of free blocks in the heap, as a Block_Number_t integer </dd></dl>

</div>
</div><p>
<a class="anchor" name="eef5726b049ea781dac527c085dac1e1"></a><!-- doxytag: member="DynAlloc.h::Mem_TotalFreeHandles" ref="eef5726b049ea781dac527c085dac1e1" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d8/d41/a00038.html#7fbda3b3fd15b09edb224cd5dac547a3">Handle_Number_t</a> Mem_TotalFreeHandles           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Returns the total number of unallocated handles in the handle pool.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Number of free handles in the handle pool, as a Handle_Number_t integer </dd></dl>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Oct 2 18:01:17 2008 for MyUSB Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
