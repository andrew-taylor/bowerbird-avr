<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>MyUSB Library: Migrating from V1.4.1 to 1.5.0</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="Page_Migration141">Migrating from V1.4.1 to 1.5.0 </a></h1>Below is migration information for updating existing projects based on the MyUSB library version 1.4.1 to the 1.5.0 API. It does not indicate all new additions to the library, only areas relevant to making older projects compatible with the new API.<p>
<b>Library Demos</b><ul>
<li>Previous versions of the library demos had incorrectly encoded BCD version numbers in the descriptors. To avoid such mistakes in the future, the VERSION_BCD macro has been added to <a class="el" href="da/dec/a00080.html">StdDescriptors.h</a>. Existing projects should at least manually correct the BCD version numbers, or preferably update the descriptors to encode the version number in BCD format using the new macro.</li><li>The mandatory GetReport class-specific request was accidentally ommitted from previous versions of the demos based on the Human Interface Device (HID) class. This has been corrected, and any user projects based on the HID demos should also be updated accordingly.</li><li>The CDC demos now correctly send an empty packet directly after a full packet, to end the transmission. Failure to do this on projects which always or frequently send full packets will cause buffering issues on the host OS. All CDC user projects are advised to update their transmission routines in the same manner as the library CDC demos.</li><li>The previous interrupt-driven Endpoint/Pipe demos did not properly save and restore the currently selected Endpoint/Pipe when the ISR fired. This has been corrected - user projects based on the interrupt driven demos should also update to properly save and restore the selected Endpoint/Pipe.</li></ul>
<p>
<b>Non-USB Library Components</b><ul>
<li>The Atomic.h and ISRMacro.h header files in MyUSB/Common have been removed, as the library is now only compatible with avr-libc library versions newer than the time before the functionality of the deleted headers was available.</li></ul>
<p>
<b>Device Mode</b><ul>
<li>The GetDescriptor function (see <a class="el" href="da/dec/a00080.html">StdDescriptors.h</a>) now has a new prototype, with altered parameter names and functions. Existing projects will need to update the GetDescriptor implementation to reflect the new API. The previously split Type and Index parameters are now passed as the original wValue parameter to the function, to make way for the USB specification wIndex parameter which is <em>not</em> the same as the previous Index parameter.</li><li>The USB_UnhandledControlPacket event (see <a class="el" href="d5/db6/a00042.html">Events.h</a>) now has new parameter names, to be in line with the official USB specification. Existing code will need to be altered to use the new parameter names.</li><li>The USB_CreateEndpoints event (see <a class="el" href="d5/db6/a00042.html">Events.h</a>) has been renamed to USB_ConfigurationChanged, which is more appropriate. It fires in an identical manner to the previously named event, thus the only change to be made is the event name itself in the user project.</li><li>The USB_Descriptor_Language_t structure no longer exists in <a class="el" href="da/dec/a00080.html">StdDescriptors.h</a>, as this was a psudo-descriptor modelled on the string descriptor. It is replaced by the true <a class="el" href="d7/d7a/a00016.html">USB_Descriptor_String_t</a> type descriptor as indicated in the USB specification, thus all device code must be updated accordingly.</li><li>The names of several Endpoint macros have been changed to be more consistant with the rest of the library, with no implementation changes. This means that existing code can be altered to use the new macro names with no other considerations required. See <a class="el" href="db/d3a/a00040.html">Endpoint.h</a> for the new macro names.</li><li>The previous version of the MassStorage demo had an incorrect value in the SCSI_Request_Sense_Response_t strucuture named SenseData in SCSI.c which caused some problems with some hosts. User projects based on this demo should correct the structure value to maintain compatibility across multiple OS platforms.</li><li>By default, the descriptor structures use the official USB specification names for the elements. Previous versions of the library used non-standard (but more verbose) names, which are still usable in the current and future releases when the correct compile time option is enabled. See the <a class="el" href="da/dec/a00080.html">StdDescriptors.h</a> file documentation for more details.</li></ul>
<p>
<b>Host Mode</b><ul>
<li>The <a class="el" href="d4/d51/a00017.html">USB_Host_Request_Header_t</a> structure in <a class="el" href="d5/de0/a00050.html">HostChapter9.h</a> (used for issuing control requests) has had its members renamed to the official USB specification names for requests. Existing code will need to be updated to use the new names.</li><li>The names of several Pipe macros have been changed to be more consistant with the rest of the library, with no implementation changes. This means that existing code can be altered to use the new macro names with no other considerations required. See <a class="el" href="d0/d89/a00071.html">Pipe.h</a> for the new macro names.</li><li>By default, the descriptor structures use the official USB specification names for the elements. Previous versions of the library used non-standard (but more verbose) names, which are still usable in the current and future releases when the correct compile time option is enabled. See the <a class="el" href="da/dec/a00080.html">StdDescriptors.h</a> file documentation for more details.</li><li>The names of the macros in <a class="el" href="d4/dca/a00048.html">Host.h</a> for controlling the SOF generation have been renamed, see the <a class="el" href="d4/dca/a00048.html">Host.h</a> module documentation for the new macro names.</li></ul>
<p>
<b>Dual Role Mode</b><ul>
<li>The <a class="el" href="d4/d31/a00069.html">OTG.h</a> header file has been corrected so that the macros now perform their stated functions. Any existing projects using custom headers to fix the broken OTG header should now be altered to once again use the OTG header inside the library.</li><li>The USB_DeviceEnumerationComplete event (see <a class="el" href="d5/db6/a00042.html">Events.h</a>) now also fires in Device mode, when the host has finished enumerating the device. Projects relying on the event only firing in Host mode should be updated so that the event action only ocurrs when the USB_Mode global is set to USB_MODE_HOST. </li></ul>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Oct 2 18:01:18 2008 for MyUSB Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
